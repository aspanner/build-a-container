<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Containers and Persistence :: BUILD-A-CONTAINER WORKSHOP</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/build-a-container/intro-container-workshop/1.0/container-persistence.html">
    <link rel="prev" href="podman-intro.html">
    <link rel="next" href="containers-and-security.html">
    <meta name="description" content="Introduction to Containers, Container Security and Container Tools including Podman and Buildah">
    <meta name="keywords" content="docker, podman, buildah, skopeo, security, secure containers, containers, Red Hat, RHEL, Linux, Containerization, cloud, build a container, workshop, cloud native, openshift">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RCLP96B4SM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RCLP96B4SM');
</script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript">

   $( document ).ready(function() {
    $('li.version a, a.version').click(function() {
            var querystring = window.location.search;
            var href = $(this).attr('href');
            location.href = href + querystring;
            return false;
      });
  });
    
  </script>
  <style>
    /* override master stylesheet properties for this partial here */

    .navbar-item {
      flex: unset;
    }

    .doc {
      max-width: unset;
    }

    .bac-red {
        color: red;
    }
    .bac-h1 {
        font-size: 1.8em;
        margin: auto;
        display:table;
        color: red;
    }

  </style>

  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/build-a-container">BUILD-A-CONTAINER WORKSHOP</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
        <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-scholars.github.io/outer-loop-guides/" target="_blank">Outer Loop</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/openshift-starter-guides/" target="_blank">OpenShift Starter</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="intro-container-workshop" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">BUILD-A-CONTAINER</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#open_code_server">Code Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#open_code_server_terminal">Open Terminal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#open_code_server_terminal_commands">Issuing Terminal Commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#local_browser">Local Browser</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text">&#8203;</span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><em>Module I</em></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="container-anatomy.html">Container Anatomy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#what_makes_up_a_container">What makes up a Container?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_image_format">Container Image Format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_file">Containerfile</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_identification">Container Identification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_runtime">Container Runtime</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_tools">Container Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#container_registries">Container Registries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="container-anatomy.html#more_information">More information</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="podman-intro.html">Running Containers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#run_container">Add a website</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#enter_container">Look inside a container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#copy_data">Copying data out</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#committing_containers">Committing Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#stop_container">Stopping Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#remove_containers">Removing Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-intro.html#rerunning_container">Re-running Containers</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="container-persistence.html">Persistence and Containers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mounting_volumes">Mounting Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#test_mount">Testing the Volume Mount</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text">&#8203;</span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><em>Module II</em></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="containers-and-security.html">Container Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="containers-and-security.html#exploit_containers">Exploit a Container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="containers-and-security.html#run_containers_responsibly">Run Containers Responsibly</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="containers-and-security.html#scanning_containers">Scanning Containers for Security Issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="build-your-own-container.html">Building Securely</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build-your-own-container.html">Build your own Secure Container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build-your-own-container-containerfile.html">Buildah and Containerfiles</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deploy-container.html">Deploying to OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">&#8203;</span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><em>Module III</em></span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="DATABASES/databases-and-containers.html">Containerized Databases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="PODMAN_COMPOSE/compose-container.html">Docker Compose &amp; Pods</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="PODMAN_ROOTLESS/podman-rootless.html">Rootless Containers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text">&#8203;</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="references.html"><em>References</em></a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="contributions.html"><em>Contributions</em></a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">BUILD-A-CONTAINER</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">BUILD-A-CONTAINER</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">BUILD-A-CONTAINER</a></li>
    <li><a href="container-persistence.html">Persistence and Containers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/bfarr/projects/build-a-container/documentation/modules/ROOT/pages/container-persistence.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Containers and Persistence</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>10 MINUTE EXERCISE</em></p>
</div>
<div class="paragraph">
<p>Containers are meant to be run as "immutable" instances that exactly match the state of the image that they were started from (as we saw in the last section).  However, there many scenarios where adjusting this otherwise immutable state would be useful such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Having the containers running the same image run differently in different environments (e.g. Pre-Production vs Production environments)</p>
<div class="ulist">
<ul>
<li>
<p>For instance, having applications in the container consume different configuration data based on the environment</p>
</li>
</ul>
</div>
</li>
<li>
<p>Persisting state beyond the life of the container (e.g. Databases, logfiles)</p>
</li>
<li>
<p>Sharing state between containers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Luckily, containers have facilities to support all these things.  We&#8217;ll explore some of these features in this section</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mounting_volumes"><a class="anchor" href="#mounting_volumes"></a>Mounting Volumes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whilst containers have their own immutable filesystem, it is possible for containers to "mount" volumes that are outside the container&#8217;s filesystem.  This opens up opportunities for persisting state on those mounted filesystems or sharing that state with processes outside the container.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This can also open a number of security concerns for our containers as we&#8217;ll see later on!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Going back to our website, let&#8217;s see how we can run our webserver in such a way that we can persist our visitor_info.txt.  Our strategy will be to have the container write to a file that is <strong>local to our VM filesystem</strong> instead of into the container&#8217;s filesystem.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, let&#8217;s remove (and stop) any container that we might have running (such as the container based on <code>container-workshop-commit</code>):</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman rm -a \
    --force <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a bit of a violent way to stop and remove a running container.  It&#8217;s a little bit like using <code>kill -9</code> to stop a linux process.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Since we&#8217;re going to use the VM&#8217;s filesystem for persistence, we don&#8217;t need to use our committed image (<code>container-workshop-commit</code>) anymore, especially now that we&#8217;ve copied off of it the <code>visitor_info.txt</code> we&#8217;d like to use.  Let&#8217;s remove that image from our machine<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman rmi \<i class="conum" data-value="1"></i><b>(1)</b>
   localhost/container-workshop-commit <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>rmi</code> stands for <em>remove image</em>.  Don&#8217;t confuse this with <code>rm</code> which has to do with removing containers that are stopped</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;re removing based on the image name.  We could also remove by <code>IMAGE ID</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>If the command worked, you should see output like the following:</p>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Untagged: localhost/container-workshop-commit:latest
Deleted: f154f395c55ed7192f180502495b96cb3c223d9ce50273cda41bb63e272be7d8</code></pre>
</div>
</div>
</li>
<li>
<p>Next, we&#8217;ll <span id="podman_run_httpd">run</span> our initial <code>quay.io/bfarr/container-workshop-httpd:0.0.6</code> image, but this time with an additional <code>-v</code> option</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman run \
    --privileged \
    -d \
    -p 8081:80/tcp \
    --name my-web-server \
    -v /home/%USER%/container-workshop:/var/log/www:Z \<i class="conum" data-value="1"></i><b>(1)</b>
    quay.io/bfarr/container-workshop-httpd:0.0.6</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The format of the volume mount option is &lt;host_path&gt;:&lt;container_path&gt;:&lt;options&gt;.  In our case, we&#8217;re mounting <code>/home/%USER%/container-workshop</code> at <code>/var/log/www</code> in the container.  The <code>Z</code> option is for SELinux it tells podman to relabel the volume&#8217;s content to match the label inside the container</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test_mount"><a class="anchor" href="#test_mount"></a>Testing the Volume Mount</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the container is running mounted to the <code>/home/%USER%/container-workshop</code> on the host, we should be able to test out its effects</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you have the <code>visitor_info.txt</code> open in VSCode in an editor pane next to the <strong>Browser Preview</strong> pane as shown</p>
<div class="imageblock">
<div class="content">
<img src="_images/mounted-visitor-info-setup.jpg" alt="mounted visitor info setup">
</div>
</div>
</li>
<li>
<p>Next, navigate to the guestbook URL by navigating pasting this in the <strong>Browser Preview</strong></p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code>localhost:8081/hello.html</code></pre>
</div>
</div>
</li>
<li>
<p>Once there, enter a name (such as <em>Danny</em>) into the name field and press Submit</p>
</li>
<li>
<p>You should now see <em>Danny</em> (or whatever name you entered) added to the <code>visitor_info.txt</code> on the host in real time</p>
<div class="imageblock">
<div class="content">
<img src="_images/mounted-visitor-info.jpg" alt="mounted visitor info">
</div>
<div class="title">Figure 1. See visitors on the host</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. You can keep images around if you&#8217;d like, but like VM snapshots they take of space on the host filesystem.  Generally it&#8217;s good practice to remove images from your system that you are no longer using
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="podman-intro.html" class="query-params-link">Running Containers</a></span>
  <span class="next"><a href="containers-and-security.html" class="query-params-link">Container Security</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>  </body>
</html>
